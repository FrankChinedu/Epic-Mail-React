"use strict";require("dotenv/config");var _express=_interopRequireDefault(require("express"));var _bodyParser=_interopRequireDefault(require("body-parser"));var _cors=_interopRequireDefault(require("cors"));var _morgan=_interopRequireDefault(require("morgan"));var _swaggerUiExpress=_interopRequireDefault(require("swagger-ui-express"));var _webpack=_interopRequireDefault(require("webpack"));var _webpackDevMiddleware=_interopRequireDefault(require("webpack-dev-middleware"));var _webpackHotMiddleware=_interopRequireDefault(require("webpack-hot-middleware"));var _yamljs=_interopRequireDefault(require("yamljs"));var _path=_interopRequireDefault(require("path"));var _webpack2=_interopRequireDefault(require("../webpack.config"));var _index=_interopRequireDefault(require("./routes/index"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}/* eslint-disable import/no-dynamic-require */const app=(0,_express.default)();if(process.env.NODE_ENV!=='test'){const swaggerDocument=_yamljs.default.load(`${__dirname}/../swagger.yaml`);app.use('/api-docs',_swaggerUiExpress.default.serve,_swaggerUiExpress.default.setup(swaggerDocument));}if(process.env.NODE_ENV==='development'){/* istanbul ignore next */const compiler=(0,_webpack.default)(_webpack2.default);/* istanbul ignore next */app.use((0,_webpackDevMiddleware.default)(compiler,{hot:true,publicPath:_webpack2.default.output.publicPath}));/* istanbul ignore next */app.use((0,_webpackHotMiddleware.default)(compiler));}app.use((0,_cors.default)({origin:'*',methods:'GET, HEAD, PUT, PATCH, POST, DELETE, OPTIONS',preflightContinue:false,optionsSuccessStatus:204}));app.all('*',(req,res,next)=>{res.header('Access-Control-Allow-Origin','*');res.header('Access-Control-Allow-Headers','X-Requested-With');next();});app.use(_bodyParser.default.urlencoded({extended:true}));app.use((0,_morgan.default)('combined'));app.use(_bodyParser.default.json());app.use((0,_cors.default)());const apiURL='/api/v1';global.apiURL=apiURL;(0,_index.default)(app);app.use(_express.default.static(_path.default.resolve(__dirname,'public')));/* istanbul ignore next */app.get('*',(req,res)=>res.sendFile(_path.default.resolve(__dirname,'public/index.html')));if(!module.parent){/* istanbul ignore next */app.listen(process.env.PORT,()=>{/* istanbul ignore next */console.log(`server start at port ${process.env.PORT} `);});}module.exports=app;